---
# yaml-language-server: $schema=https://kubernetes-schemas.noirprime.com/operator.victoriametrics.com/vmservicescrape_v1beta1.json
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMServiceScrape
metadata:
  name: vmScrape-kubelet
spec:
  endpoints:
    - port: metrics
      metricRelabelConfigs:
        # Drop high-cardinality labels.
        - action: labeldrop
          regex: (uid|id|name)
        - action: drop
          sourceLabels: [__name__]
          regex: (rest_client_request_duration_seconds_bucket|rest_client_request_duration_seconds_sum|rest_client_request_duration_seconds_count)
        # Optional, Drop cgroup metrics with no pod.
        - sourceLabels: [id, pod]
          action: drop
          regex: ".+;"
        # Optional, Drop less useful container blkio metrics.
        - sourceLabels: [__name__]
          action: drop
          regex: "container_blkio_device_usage_total"
        # Optional, Drop less useful container filesystem io metrics.
        - sourceLabels: [__name__]
          action: drop
          regex: "container_fs_(io_current|io_time_seconds_total|io_time_weighted_seconds_total|reads_merged_total|sector_reads_total|sector_writes_total|writes_merged_total)"
        # Optional, Drop less useful container process metrics.
        - sourceLabels: [__name__]
          action: drop
          regex: "container_(tasks_state|threads_max)"
# ! no finished, ref:https://github.com/VictoriaMetrics/helm-charts/blob/master/charts/victoria-metrics-k8s-stack/templates/servicemonitors.yaml
