---
apiVersion: v1
kind: ConfigMap
metadata:
  name: dify-app
data:
  # : shared-api-worker-env
  # https://github.com/langgenius/dify/blob/1.9.0/api/.env.example
  # :: global
  LANG: "en_US.UTF-8"
  LC_ALL: "en_US.UTF-8"
  PYTHONIOENCODING: "utf-8"
  FILES_URL: "http://dify-app.selfhosted-apps.svc.cluster.local:5001"
  FILES_ACCESS_TIMEOUT: "300"
  ACCESS_TOKEN_EXPIRE_MINUTES: "60"
  REFRESH_TOKEN_EXPIRE_DAYS: "30"
  LOG_LEVEL: "INFO"
  LOG_FILE: "/app/logs/server.log"
  LOG_FILE_MAX_SIZE: "20"
  LOG_FILE_BACKUP_COUNT: "5"
  LOG_DATEFORMAT: "%Y-%m-%d %H:%M:%S"
  LOG_TZ: "Asia/Shanghai"
  # :: database
  DB_HOST: "postgres-rw.database-system.svc.cluster.local"
  DB_PORT: "5432"
  DB_USERNAME: "dify-database"
  DB_PASSWORD: "dify-database"
  DB_DATABASE: "dify-database"
  SQLALCHEMY_POOL_PRE_PING: "true"
  SQLALCHEMY_POOL_TIMEOUT: "30"
  # :: redis
  REDIS_HOST: "dify-database-dragonfly.selfhosted-apps.svc.cluster.local"
  REDIS_PORT: "6379"
  REDIS_USE_SSL: "false"
  REDIS_DB: "0"
  CELERY_BROKER_URL: "redis://dify-database-dragonfly.selfhosted-apps.svc.cluster.local:6379/1"
  CELERY_BACKEND: "redis"
  # :: storage
  STORAGE_TYPE: "opendal"
  OPENDAL_SCHEME: "fs"
  OPENDAL_FS_ROOT: "storage"
  # :: vector
  VECTOR_STORE: "pgvecto-rs"
  PGVECTO_RS_HOST: "postgres-rw.database-system.svc.cluster.local"
  PGVECTO_RS_PORT: "5432"
  PGVECTO_RS_USER: "dify-app"
  PGVECTO_RS_PASSWORD: "dify-app"
  PGVECTO_RS_DATABASE: "dify-app"
  # :: code
  CODE_EXECUTION_ENDPOINT: "http://dify-database-dragonfly.selfhosted-apps.svc.cluster.local:8194"
  CODE_EXECUTION_API_KEY: "dify-sandbox"
  CODE_MAX_NUMBER: "9223372036854775807"
  CODE_MIN_NUMBER: "-9223372036854775808"
  CODE_MAX_STRING_LENGTH: "80000"
  TEMPLATE_TRANSFORM_MAX_LENGTH: "80000"
  CODE_MAX_STRING_ARRAY_LENGTH: "30"
  CODE_MAX_OBJECT_ARRAY_LENGTH: "30"
  CODE_MAX_NUMBER_ARRAY_LENGTH: "1000"
  # :: api
  API_TOOL_DEFAULT_CONNECT_TIMEOUT: "10"
  API_TOOL_DEFAULT_READ_TIMEOUT: "60"
  RESPECT_XFORWARD_HEADERS_ENABLED: "false"
  INDEXING_MAX_SEGMENTATION_TOKENS_LENGTH: "4000"
  PLUGIN_MAX_PACKAGE_SIZE: "52428800"
  # :: workflow
  WORKFLOW_MAX_EXECUTION_STEPS: "500"
  WORKFLOW_MAX_EXECUTION_TIME: "1200"
  WORKFLOW_CALL_MAX_DEPTH: "5"
  WORKFLOW_PARALLEL_DEPTH_LIMIT: "3"
  MAX_VARIABLE_SIZE: "204800"
  # :: worker
  GRAPH_ENGINE_MIN_WORKERS: "1"
  GRAPH_ENGINE_MAX_WORKERS: "10"
  GRAPH_ENGINE_SCALE_UP_THRESHOLD: "3"
  GRAPH_ENGINE_SCALE_DOWN_IDLE_TIME: "5.0"
  WORKFLOW_NODE_EXECUTION_STORAGE: "rdbms"
  WORKFLOW_LOG_CLEANUP_ENABLED: "true"
  WORKFLOW_LOG_RETENTION_DAYS: "30"
  WORKFLOW_LOG_CLEANUP_BATCH_SIZE: "100"
  WORKFLOW_FILE_UPLOAD_LIMIT: "10"
  # :: repository
  CORE_WORKFLOW_EXECUTION_REPOSITORY: "core.repositories.sqlalchemy_workflow_execution_repository.SQLAlchemyWorkflowExecutionRepository"
  CORE_WORKFLOW_NODE_EXECUTION_REPOSITORY: "core.repositories.sqlalchemy_workflow_node_execution_repository.SQLAlchemyWorkflowNodeExecutionRepository"
  API_WORKFLOW_RUN_REPOSITORY: "repositories.sqlalchemy_api_workflow_run_repository.DifyAPISQLAlchemyWorkflowRunRepository"
  API_WORKFLOW_NODE_EXECUTION_REPOSITORY: "repositories.sqlalchemy_api_workflow_node_execution_repository.DifyAPISQLAlchemyWorkflowNodeExecutionRepository"
  # :: app
  APP_MAX_ACTIVE_REQUESTS: "0"
  APP_MAX_EXECUTION_TIME: "1200"
  ALLOW_EMBED: "false"
  # :: http node
  HTTP_REQUEST_NODE_MAX_BINARY_SIZE: "10485760"
  HTTP_REQUEST_NODE_MAX_TEXT_SIZE: "1048576"
  HTTP_REQUEST_NODE_SSL_VERIFY: "true"
  # :: upload
  UPLOAD_FILE_SIZE_LIMIT: "15"
  UPLOAD_FILE_BATCH_LIMIT: "5"
  UPLOAD_IMAGE_FILE_SIZE_LIMIT: "10"
  UPLOAD_VIDEO_FILE_SIZE_LIMIT: "100"
  UPLOAD_AUDIO_FILE_SIZE_LIMIT: "50"
  # :: marketplace
  MARKETPLACE_ENABLED: "true"
  MARKETPLACE_API_URL: "https://marketplace.dify.ai"
  # :: endpoint
  ENDPOINT_URL_TEMPLATE: "http://dify-database.selfhosted-apps.svc.cluster.local:5002/e/{hook_id}"
  # :: password
  RESET_PASSWORD_TOKEN_EXPIRY_MINUTES: "5"
  EMAIL_REGISTER_TOKEN_EXPIRY_MINUTES: "5"
  CHANGE_EMAIL_TOKEN_EXPIRY_MINUTES: "5"
  OWNER_TRANSFER_TOKEN_EXPIRY_MINUTES: "5"
  # :: model
  MULTIMODAL_SEND_FORMAT: "base64"
  PROMPT_GENERATION_MAX_TOKENS: "512"
  CODE_GENERATION_MAX_TOKENS: "1024"
  PLUGIN_BASED_TOKEN_COUNTING_ENABLED: "false"
  # :: debug
  DEPLOY_ENV: "PRODUCTION"
  ETL_TYPE: "dify"
  SCARF_NO_ANALYTICS: "true"
